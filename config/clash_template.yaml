# =========================
# 基础设置
# =========================
port: 7890
socks-port: 7891
mixed-port: 7892
allow-lan: false
mode: Rule
log-level: info
ipv6: true

# Meta内核优化
unified-delay: true
tcp-concurrent: true

external-controller: 0.0.0.0:9090
profile:
  store-selected: true
  store-fake-ip: true

# =========================
# DNS 设置
# =========================
dns:
  enable: true
  listen: 0.0.0.0:53
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  
  default-nameserver:
    - 223.5.5.5
    - 1.1.1.1

  nameserver:
    - quic://223.5.5.5/dns-query
    - quic://223.6.6.6/dns-query
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query

  fallback:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
    - tcp://8.8.4.4
    - tcp://1.0.0.1
  
  fallback-filter:
    geoip: true
    ipcidr:
      - 240.0.0.0/4

  # 对应 Surge: always-real-ip
  fake-ip-filter:
    - "dns.msftncsi.com"
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "xbox.*.microsoft.com"
    - "+.xboxlive.com"
    - "+.turn.twilio.com"
    - "+.stun.twilio.com"
    - "stun.syncthing.net"
    - "stun.*"
    - "+.local"
    - "localhost"
    - "e.crashlytics.com"
    - "captive.apple.com"
    - "msftconnecttest.com"
    - "+.battlenet.com.cn"

# =========================
# 规则集合 (Rule Providers)
# =========================
rule-providers:
  Advertising:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising.yaml"
    path: ./rules/Advertising.yaml
    interval: 86400

  Advertising_Domain:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Advertising/Advertising_Domain.yaml"
    path: ./rules/Advertising_Domain.yaml
    interval: 86400

  DingTalk:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/DingTalk/DingTalk.yaml"
    path: ./rules/DingTalk.yaml
    interval: 86400

  Google:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml"
    path: ./rules/Google.yaml
    interval: 86400

  OpenAI:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
    path: ./rules/OpenAI.yaml
    interval: 86400

  Gemini:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml"
    path: ./rules/Gemini.yaml
    interval: 86400

  Bing:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Bing/Bing.yaml"
    path: ./rules/Bing.yaml
    interval: 86400

  YouTube:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
    path: ./rules/YouTube.yaml
    interval: 86400
  
  Telegram:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml"
    path: ./rules/Telegram.yaml
    interval: 86400

  Netflix:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.yaml"
    path: ./rules/Netflix.yaml
    interval: 86400

  Disney:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Disney/Disney.yaml"
    path: ./rules/Disney.yaml
    interval: 86400

  Twitter:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.yaml"
    path: ./rules/Twitter.yaml
    interval: 86400  

  GitHub:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.yaml"
    path: ./rules/GitHub.yaml
    interval: 86400

  Steam:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Steam/Steam.yaml"
    path: ./rules/Steam.yaml
    interval: 86400

  Scholar:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Scholar/Scholar.yaml"
    path: ./rules/Scholar.yaml
    interval: 86400   

  Claude:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Claude/Claude.yaml"
    path: ./rules/Claude.yaml
    interval: 86400  

rules:
  # 1. 进程规则 (Process)
  # 对应 Surge: PROCESS-NAME,Telegram,REJECT-DROP
  # 注意：在 Windows/macOS 上可能需要管理员权限才能匹配进程
  - PROCESS-NAME,Telegram,Auto

  # 2. 广告拦截
  - RULE-SET,Advertising,REJECT
  - RULE-SET,Advertising_Domain,REJECT

  # 3. 直连规则 (Direct)
  - DOMAIN-SUFFIX,apple.com,DIRECT
  - DOMAIN-SUFFIX,icloud.com,DIRECT
  - RULE-SET,DingTalk,DIRECT

  # 4. 指定线路 (Static-IP)
  - RULE-SET,Google,Static-IP
  - RULE-SET,OpenAI,Static-IP
  - RULE-SET,Gemini,Static-IP
  - RULE-SET,Bing,Static-IP
  - RULE-SET,Twitter,Static-IP
  - RULE-SET,Scholar,Static-IP
  - RULE-SET,Claude,Static-IP  
  
  # 5. 自动测速 (Auto)
  - RULE-SET,YouTube,Auto
  - RULE-SET,Telegram,Auto
  - DOMAIN-SUFFIX,microsoft.com,Auto
  - RULE-SET,GitHub,Auto
  - RULE-SET,Steam,Auto

  # 6. 流媒体
  - RULE-SET,Netflix,Netflix
  - RULE-SET,Disney,Disney

  # 7. 局域网防漏
  - GEOIP,PRIVATE,DIRECT
  - GEOIP,CN,DIRECT
  
  # 8. 兜底
  - MATCH,Auto